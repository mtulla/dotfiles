FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=Etc/UTC

# Create a non-root user with passwordless sudo.
# Install curl and git upfront â€” chezmoi init needs both.
RUN apt-get update && \
    apt-get install -y sudo curl git tzdata software-properties-common && \
    useradd -m -s /bin/bash testuser && \
    echo "testuser:testpass" | chpasswd && \
    echo "testuser ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

ENV CHEZMOI_TEST_PASSWORD=testpass

USER testuser
WORKDIR /home/testuser

CMD ["sh", "-c", "curl -fsLS get.chezmoi.io | sh -s -- init --apply --promptBool 'is_dd_laptop=false' --branch testing mtulla"]
